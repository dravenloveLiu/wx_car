<view class="container">
  <block wx:if="{{!loading && serviceInfo}}">
    <!-- æœåŠ¡åŸºæœ¬ä¿¡æ¯ -->
    <view class="service-card">
      <view class="service-header">
        <text class="service-type">{{serviceInfo.serviceType}}</text>
        <text class="service-status {{serviceInfo.status}}">{{steps[currentStepIndex].name}}</text>
      </view>
      
      <view class="car-info">
        <view class="info-item">
          <text class="label">è½¦å‹ï¼š</text>
          <text class="value">{{serviceInfo.carModel}}</text>
        </view>
        <view class="info-item">
          <text class="label">è½¦ç‰Œï¼š</text>
          <text class="value">{{serviceInfo.plateNumber}}</text>
        </view>
      </view>
    </view>

    <!-- è¿›åº¦æ—¶é—´è½´ -->
    <view class="progress-timeline">
      <view class="timeline-item {{getStepStyle(index)}}" wx:for="{{steps}}" wx:key="status">
        <view class="timeline-dot"></view>
        <view class="timeline-content">
          <text class="step-name">{{item.name}}</text>
          <text class="step-time" wx:if="{{serviceInfo.timeline[item.status]}}">
            {{formatDate(serviceInfo.timeline[item.status])}}
          </text>
        </view>
        <view class="timeline-line" wx:if="{{index < steps.length - 1}}"></view>
      </view>
    </view>

    <!-- æœåŠ¡è¯¦æƒ… -->
    <view class="detail-card">
      <view class="card-title">æœåŠ¡è¯¦æƒ…</view>
      <view class="detail-list">
        <view class="detail-item">
          <text class="label">æœåŠ¡é¡¹ç›®ï¼š</text>
          <text class="value">{{serviceInfo.serviceItems}}</text>
        </view>
        <view class="detail-item">
          <text class="label">å¼€å§‹æ—¶é—´ï¼š</text>
          <text class="value">{{formatDate(serviceInfo.startTime)}}</text>
        </view>
        <view class="detail-item">
          <text class="label">é¢„è®¡å®Œæˆï¼š</text>
          <text class="value">{{formatDate(serviceInfo.estimatedFinishTime)}}</text>
        </view>
        <view class="detail-item">
          <text class="label">æœåŠ¡é‡‘é¢ï¼š</text>
          <text class="value price">Â¥{{serviceInfo.price}}</text>
        </view>
        <view class="detail-item" wx:if="{{serviceInfo.notes}}">
          <text class="label">å¤‡æ³¨ï¼š</text>
          <text class="value">{{serviceInfo.notes}}</text>
        </view>
      </view>
    </view>

    <!-- å½“å‰ç¯èŠ‚ä¿¡æ¯ -->
    <view class="current-step-card" wx:if="{{serviceInfo.currentStepInfo}}">
      <view class="card-title">å½“å‰ç¯èŠ‚</view>
      <view class="step-info">
        <view class="step-desc">{{serviceInfo.currentStepInfo.description}}</view>
        <view class="technician-info" wx:if="{{serviceInfo.currentStepInfo.technician}}">
          <image class="technician-avatar" src="{{serviceInfo.currentStepInfo.technician.avatar}}" mode="aspectFill"></image>
          <view class="technician-detail">
            <text class="technician-name">{{serviceInfo.currentStepInfo.technician.name}}</text>
            <text class="technician-title">{{serviceInfo.currentStepInfo.technician.title}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- åº•éƒ¨æ“ä½œæ  -->
    <view class="bottom-bar">
      <button class="contact-btn" bindtap="contactService">
        <text class="icon">ğŸ“</text>
        è”ç³»å®¢æœ
      </button>
    </view>
  </block>

  <!-- åŠ è½½ä¸­çŠ¶æ€ -->
  <view class="loading-state" wx:if="{{loading}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">åŠ è½½ä¸­...</text>
  </view>
</view> 